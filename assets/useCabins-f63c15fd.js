import{I as t,T as m,o as b}from"./index-0a34fab9.js";async function g(){const{data:e,error:r}=await t.from("cabins").select("*").order("created_at",{ascending:!0});if(r)throw console.error(r),new Error("Cabins could not be loaded");return e}async function h(e,r){var n,l;const a=(l=(n=e.image)==null?void 0:n.startsWith)==null?void 0:l.call(n,m),i=`${Math.random()}-${e.image.name}`.replaceAll("/",""),c=a?e.image:`${m}/storage/v1/object/public/cabin-images/${i}`;let o=t.from("cabins");r||(o=o.insert([{...e,image:c}])),r&&(o=o.update({...e,image:c}).eq("id",r));const{data:s,error:d}=await o.select().single();if(d)throw console.error(d),new Error("Cabin could not be created");if(a)return s;const{error:u}=await t.storage.from("cabin-images").upload(i,e.image);if(u)throw await t.from("cabins").delete().eq("id",s.id),console.error(u),new Error("Cabin image could not be uploaded and the cabin was not created");return s}async function p(e){const{data:r,error:a}=await t.from("cabins").delete().eq("id",e);if(a)throw console.error(a),new Error("Cabin could not be deleted");return r}function w(){const{isLoading:e,data:r,error:a}=b({queryKey:["cabins"],queryFn:g});return{isLoading:e,error:a,cabins:r}}export{h as c,p as d,w as u};
